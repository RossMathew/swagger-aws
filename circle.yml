machine:
  node:
    version: 6.1.0
  services:
    - docker

test:
  pre:
    - mkdir -p $CIRCLE_TEST_REPORTS/jest
  override:
    - npm test -- --max-parallel 1 -- --maxWorkers=2:
        environment:
          JEST_JUNIT_OUTPUT: $CIRCLE_TEST_REPORTS/jest/junit.xml
    - npm run flow:stop
    - npm run selenium:docker-compose:up
    - npm run e2e:headless
    - npm run e2e:coverage:headless
  post:
    - npm run istanbul:report -- text
    - npm run istanbul:report -- text-lcov | coveralls:
        environment:
          COVERALLS_SERVICE_NAME: CircleCI
          COVERALLS_SERVICE_JOB_ID: $CIRCLE_BUILD_NUM
